{% extends 'base.html' %}

{% block content %}
<div class="container">
    <!-- Hero —Å–µ–∫—Ü–∏—è -->
    <div class="hero-section text-white py-5 mb-5 rounded">
        <div class="container">
            <div class="row justify-content-center text-center">
                <div class="col-lg-8">
                    <h1 class="display-4 fw-bold mb-4">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É</h1>
                    <p class="lead mb-4">–°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è —Å –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º</p>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <h3 class="fw-bold">{{ total_courses }}+</h3>
                            <p class="mb-0">–ö—É—Ä—Å–æ–≤</p>
                        </div>
                        <div class="col-md-4">
                            <h3 class="fw-bold">{{ total_students }}+</h3>
                            <p class="mb-0">–°—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
                        </div>
                        <div class="col-md-4">
                            <h3 class="fw-bold">{{ total_teachers }}+</h3>
                            <p class="mb-0">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</p>
                        </div>
                    </div>
                    
                    {% if not user.is_authenticated %}
                    <div class="d-flex gap-3 justify-content-center flex-wrap">
                        <a href="/accounts/register/" class="btn btn-light btn-lg px-4">–ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ</a>
                        <a href="/accounts/login/" class="btn btn-outline-light btn-lg px-4">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</a>
                    </div>
                    {% else %}
                    <div class="d-flex gap-3 justify-content-center flex-wrap">
                        <a href="/accounts/profile/" class="btn btn-light btn-lg px-4">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
                        <a href="/courses/" class="btn btn-outline-light btn-lg px-4">–ú–æ–∏ –∫—É—Ä—Å—ã</a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã -->
    <div class="row mb-5">
        <div class="col-md-4 mb-4">
            <a href="{% url 'courses_list' %}" class="card h-100 text-center border-0 shadow-sm text-decoration-none hover-card">
                <div class="card-body p-4">
                    <div class="text-primary mb-3">
                        <i class="fas fa-book fa-3x"></i>
                    </div>
                    <h5 class="card-title fw-bold">–ö—É—Ä—Å—ã</h5>
                    <p class="card-text text-muted">–î–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–º –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º –∫—É—Ä—Å–∞–º –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º</p>
                    <div class="mt-3">
                        <span class="btn btn-outline-primary btn-sm">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫—É—Ä—Å—ã</span>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-4 mb-4">
            <a href="{% url 'my_courses' %}" class="card h-100 text-center border-0 shadow-sm text-decoration-none hover-card">
                <div class="card-body p-4">
                    <div class="text-success mb-3">
                        <i class="fas fa-chart-line fa-3x"></i>
                    </div>
                    <h5 class="card-title fw-bold">–ü—Ä–æ–≥—Ä–µ—Å—Å</h5>
                    <p class="card-text text-muted">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
                    <div class="mt-3">
                        <span class="btn btn-outline-success btn-sm">–ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</span>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-4 mb-4">
            <a href="#" class="card h-100 text-center border-0 shadow-sm text-decoration-none hover-card" onclick="showCommunityMessage()">
                <div class="card-body p-4">
                    <div class="text-info mb-3">
                        <i class="fas fa-users fa-3x"></i>
                    </div>
                    <h5 class="card-title fw-bold">–°–æ–æ–±—â–µ—Å—Ç–≤–æ</h5>
                    <p class="card-text text-muted">–û–±—â–∞–π—Ç–µ—Å—å —Å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º–∏ –∏ –¥—Ä—É–≥–∏–º–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏</p>
                    <div class="mt-3">
                        <span class="btn btn-outline-info btn-sm">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</span>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫—É—Ä—Å—ã -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0 fw-bold">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫—É—Ä—Å—ã</h4>
                        <a href="/courses/" class="btn btn-outline-primary btn-sm">–í—Å–µ –∫—É—Ä—Å—ã</a>
                    </div>
                </div>
                <div class="card-body p-4">
                    {% if courses %}
                    <div class="row">
                        {% for course in courses %}
                        <div class="col-lg-4 col-md-6 mb-4">
                            <a href="{% url 'course_detail' course.id %}" class="card h-100 course-card border-0 shadow-sm text-decoration-none hover-card">
                                <div class="card-body">
                                    <h6 class="card-title fw-bold">{{ course.title }}</h6>
                                    <p class="card-text text-muted small">{{ course.short_description|default:course.description|truncatewords:15 }}</p>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span class="badge {% if course.is_free %}bg-success{% else %}bg-warning text-dark{% endif %}">
                                            {% if course.is_free %}–ë–µ—Å–ø–ª–∞—Ç–Ω–æ{% else %}–ü—Ä–µ–º–∏—É–º{% endif %}
                                        </span>
                                        <small class="text-muted">{{ course.level }}</small>
                                    </div>
                                    <div class="text-center">
                                        <span class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-book-open me-1"></i>–ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                        </span>
                                    </div>
                                </div>
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-book fa-3x text-muted mb-3"></i>
                        <p class="text-muted">–ö—É—Ä—Å—ã —Å–∫–æ—Ä–æ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é -->
    <div class="row">
        <div class="col-12">
            <div class="card bg-light border-0">
                <div class="card-body text-center py-5">
                    <h3 class="fw-bold mb-3">–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ?</h3>
                    <p class="lead text-muted mb-4">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —Ç—ã—Å—è—á–∞–º —Å—Ç—É–¥–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –Ω–∞—á–∞–ª–∏ —Å–≤–æ–π –ø—É—Ç—å –≤ IT</p>
                    {% if not user.is_authenticated %}
                    <a href="/accounts/register/" class="btn btn-primary btn-lg px-5">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ</a>
                    {% else %}
                    <a href="/courses/" class="btn btn-primary btn-lg px-5">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.querySelector('input[name="search"]');
    const searchForm = document.querySelector('form[method="get"]');
    let autocompleteResults = null;
    
    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
    function createAutocompleteContainer() {
        const container = document.createElement('div');
        container.className = 'autocomplete-results position-absolute w-100';
        container.style.cssText = 'z-index: 1000; background: white; border: 1px solid #ddd; border-radius: 0.375rem; max-height: 300px; overflow-y: auto; display: none;';
        return container;
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
    function initAutocomplete() {
        const inputGroup = searchInput.closest('.input-group');
        inputGroup.style.position = 'relative';
        
        if (!autocompleteResults) {
            autocompleteResults = createAutocompleteContainer();
            inputGroup.appendChild(autocompleteResults);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞
        let timeoutId;
        searchInput.addEventListener('input', function(e) {
            clearTimeout(timeoutId);
            const query = e.target.value.trim();
            
            if (query.length < 2) {
                hideAutocomplete();
                return;
            }
            
            timeoutId = setTimeout(() => {
                fetchAutocompleteResults(query);
            }, 300);
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –≤–Ω–µ –ø–æ–ª—è
        document.addEventListener('click', function(e) {
            if (!inputGroup.contains(e.target)) {
                hideAutocomplete();
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à
        searchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                hideAutocomplete();
            }
        });
    }
    
    // –ó–∞–ø—Ä–æ—Å –∫ API –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
    function fetchAutocompleteResults(query) {
        fetch(`/api/core/course-autocomplete/?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                showAutocompleteResults(data, query);
            })
            .catch(error => {
                console.error('Error fetching autocomplete:', error);
                hideAutocomplete();
            });
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
    function showAutocompleteResults(results, query) {
        if (!results || results.length === 0) {
            hideAutocomplete();
            return;
        }
        
        const html = results.map(course => `
            <div class="autocomplete-item p-3 border-bottom" 
                 style="cursor: pointer;"
                 data-course-id="${course.id}"
                 data-course-title="${course.title}">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="mb-1 fw-bold">${highlightText(course.title, query)}</h6>
                        <p class="mb-1 text-muted small">${course.short_description || ''}</p>
                        <div class="d-flex gap-2">
                            <span class="badge ${course.is_free ? 'bg-success' : 'bg-warning'} small">
                                ${course.is_free ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : '–ü—Ä–µ–º–∏—É–º'}
                            </span>
                            <span class="badge bg-secondary small">${course.level}</span>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');
        
        autocompleteResults.innerHTML = html;
        autocompleteResults.style.display = 'block';
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–∞ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã
        const items = autocompleteResults.querySelectorAll('.autocomplete-item');
        items.forEach(item => {
            item.addEventListener('click', function() {
                const title = this.getAttribute('data-course-title');
                searchInput.value = title;
                hideAutocomplete();
                searchForm.submit();
            });
            
            item.addEventListener('mouseenter', function() {
                this.style.backgroundColor = '#f8f9fa';
            });
            
            item.addEventListener('mouseleave', function() {
                this.style.backgroundColor = '';
            });
        });
    }
    
    // –°–∫—Ä—ã—Ç—å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
    function hideAutocomplete() {
        if (autocompleteResults) {
            autocompleteResults.style.display = 'none';
        }
    }
    
    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
    function highlightText(text, query) {
        if (!query) return text;
        const regex = new RegExp(`(${query})`, 'gi');
        return text.replace(regex, '<mark>$1</mark>');
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
    initAutocomplete();
});
</script>

<style>
.autocomplete-results {
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    margin-top: 2px;
}

.autocomplete-item:hover {
    background-color: #f8f9fa !important;
}

.autocomplete-item:last-child {
    border-bottom: none !important;
}

mark {
    background-color: #fff3cd;
    padding: 0;
}
</style>
<style>
.hover-card {
    transition: all 0.3s ease;
    color: inherit;
}

.hover-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.15) !important;
    text-decoration: none;
    color: inherit;
}

.hover-card .card-body {
    transition: all 0.3s ease;
}

.hover-card:hover .card-body {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.hover-card:hover .text-primary {
    color: #0d6efd !important;
}

.hover-card:hover .text-success {
    color: #198754 !important;
}

.hover-card:hover .text-info {
    color: #0dcaf0 !important;
}
</style>
<script>
function showCommunityMessage() {
    alert('–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –±–ª–∏–∂–∞–π—à–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö! üöÄ\n\n–°–µ–π—á–∞—Å –≤—ã –º–æ–∂–µ—Ç–µ:\n‚Ä¢ –û–±—â–∞—Ç—å—Å—è —Å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∑–∞–¥–∞–Ω–∏—è–º\n‚Ä¢ –ó–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ\n‚Ä¢ –°–ª–µ–¥–∏—Ç—å –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –¥—Ä—É–≥–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤');
    
    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –∑–∞–¥–∞–Ω–∏—è–º–∏
    // setTimeout(function() {
    //     window.location.href = "{% url 'assignments_list' %}";
    // }, 1000);
}
</script>
<style>
/* –£–ª—É—á—à–µ–Ω–Ω—ã–µ hover-—ç—Ñ—Ñ–µ–∫—Ç—ã */
.hover-card {
    border: 2px solid transparent;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.hover-card:hover {
    border-color: rgba(13, 110, 253, 0.2);
    transform: translateY(-8px) scale(1.02);
}

/* –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∫—É—Ä—Å–æ–≤ */
.course-card:hover {
    border-color: rgba(13, 110, 253, 0.3);
}

/* –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ */
.hover-card .btn {
    transition: all 0.3s ease;
}

.hover-card:hover .btn-outline-primary {
    background-color: #0d6efd;
    color: white;
}

.hover-card:hover .btn-outline-success {
    background-color: #198754;
    color: white;
}

.hover-card:hover .btn-outline-info {
    background-color: #0dcaf0;
    color: white;
}
</style>
{% endblock %}